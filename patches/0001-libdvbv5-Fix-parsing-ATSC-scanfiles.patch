From f420dcf3d1e991c4185f050d660d3e0cbb70e91e Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Andr=C3=A9=20Roth?= <neolynx@gmail.com>
Date: Wed, 29 Aug 2012 22:13:35 +0200
Subject: [PATCH 1/2] libdvbv5: Fix parsing ATSC scanfiles
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Andr√© Roth <neolynx@gmail.com>
---
 lib/libdvbv5/dvb-file.c |   15 ++++++++++++---
 1 file changed, 12 insertions(+), 3 deletions(-)

diff --git a/lib/libdvbv5/dvb-file.c b/lib/libdvbv5/dvb-file.c
index 2c8905e..f06e704 100644
--- a/lib/libdvbv5/dvb-file.c
+++ b/lib/libdvbv5/dvb-file.c
@@ -93,6 +93,7 @@ struct dvb_file *parse_format_oneline(const char *fname,
 		if (*p == '\n' || *p == '#' || *p == '\a' || *p == '\0')
 			continue;
 
+                j = -1;
 		if (parse_file->has_delsys_id) {
 			p = strtok(p, delimiter);
 			if (!p) {
@@ -103,18 +104,26 @@ struct dvb_file *parse_format_oneline(const char *fname,
 
 			/* Parse the type of the delivery system */
 			for (i = 0; formats[i].id != NULL; i++) {
-				if (!strcmp(p, formats[i].id))
+				if (!strcmp(p, formats[i].id)) {
+                                        j = 1;
 					break;
+                                }
 			}
 		} else {
 			/* Seek for the delivery system */
 			for (i = 0; formats[i].delsys != 0; i++) {
-				if (formats[i].delsys == delsys)
+				if (formats[i].delsys == delsys) {
+                                        j = 1;
 					break;
+                                }
 			}
 		}
-		if (i == ARRAY_SIZE(formats))
+
+		//if (i == ARRAY_SIZE(formats)) {
+		if (j != 1) {
+		        sprintf(err_msg, "delsys not found");
 			goto error;
+                }
 
 
 		fmt = &formats[i];
-- 
1.7.9.5

